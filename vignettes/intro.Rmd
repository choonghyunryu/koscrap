---
title: "introduce koscrap"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{introduce koscrap}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## koscrap에 대하여
koscrap(Korean Scraping)은 공공데이터포털의 아파트실거래 상세 내역과 NAVER의 뉴스검색 데이터를 수집하는 패키지입니다. REST 오픈 API를 이용해서 정해진 데이터를 수집할 수 있습니다.

## koscrap 기능
현재 구현된 koscrap의 기능을 다음과 같습니다.

* 공공데이터포털의 아파트실거래
  - trade_apt()
* NAVER의 뉴스검색 
  - search_naver()

## 공공데이터포털의 아파트실거래 예제
서울특별시 노원구의 2021년도 12월의 아파트 거래 내역을 수집합니다.

먼저 공공데이터포털에서 발급받은 서비스키를 기술합니다. 본 예제는 서비스키는 개인의 정보이므로 여기서는 임의의 문자로 형식만 표기합니다.

```{r, eval=FALSE}
library("koscrap")
library("dplyr")

auth_key <- "xxxxxxxxxxxxxxxxxxx"
```

패키지에서 제공하는 법정동 코드 데이터인 `legal_divisions`로부터 노원구의 시군구 코드를 가져옵니다. 그리고 `trade_apt()`로 아파트거래정보를 수집합니다.

```{r, eval=FALSE}
LAWD_CD <- legal_divisions %>% 
  filter(CTY_NM %in% "노원구") %>% 
  select(CTY_CD) %>% 
  filter(row_number() == 1) %>% 
  pull()

nowon <- trade_apt(auth_key, 
          LAWD_CD = LAWD_CD, 
          DEAL_YMD = "202112")

glimpse(nowon)
#> Rows: 59
#> Columns: 24
#> $ LAWD_CD       <chr> "11350", "11350", "11350", "11350", "11350", "11350", "1…
#> $ DEAL_DATE     <glue> "2021-12-05", "2021-12-06", "2021-12-07", "2021-12-10",…
#> $ SERIAL        <chr> "11350-149", "11350-133", "11350-150", "11350-151", "113…
#> $ DEAL_TYPE     <chr> "중개거래", "중개거래", "중개거래", "직거래", "중개거래"…
#> $ BUILD_NM      <chr> "주공2", "한진한화그랑빌", "청백3", "청백4", "주공2", "…
#> $ FLOOR         <int> 4, 24, 13, 14, 12, 2, 15, 9, 9, 12, 14, 19, 15, 8, 16, 1…
#> $ BUILD_YEAR    <int> 1992, 2002, 1998, 1998, 1992, 2000, 1992, 1987, 1994, 19…
#> $ AREA          <chr> "58.65", "114.97", "39.84", "84.54", "44.52", "84.98", "…
#> $ AMOUNT        <int> 67500, 125000, 42500, 75000, 53800, 84500, 48000, 73600,…
#> $ ROAD_CD       <chr> "4130377", "3109006", "4130332", "4130332", "4130377", "…
#> $ ROAD_NM       <chr> "초안산로1길", "마들로", "월계로45가길", "월계로45가길",…
#> $ BUILD_MAJOR   <chr> "00018", "00031", "00089", "00094", "00018", "00049", "0…
#> $ BUILD_MINOR   <chr> "00000", "00000", "00000", "00000", "00000", "00000", "0…
#> $ ROAD_SEQ      <chr> "01", "01", "01", "01", "01", "01", "01", "01", "01", "0…
#> $ BASEMENT_FLAG <chr> "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "…
#> $ LAND_NO       <chr> "556", "18", "780", "781", "556", "929", "556", "12", "7…
#> $ DONG_NM       <chr> " 월계동", " 월계동", " 월계동", " 월계동", " 월계동", "…
#> $ DONG_MAJOR    <chr> "0556", "0018", "0780", "0781", "0556", "0929", "0556", …
#> $ DONG_MINOR    <chr> "0000", "0000", "0000", "0000", "0000", "0000", "0000", …
#> $ EUBMYNDONG_CD <chr> "10200", "10200", "10200", "10200", "10200", "10200", "1…
#> $ DONG_LAND_NO  <chr> "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "…
#> $ DEALER_ADDR   <chr> "서울 강북구, 서울 성북구", "서울 노원구", "서울 노원구"…
#> $ CANCEL_DEAL   <chr> " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", "…
#> $ CANCEL_DATE   <chr> " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", "…
```

노원구에서 12월에 가장 고가로 매매된 아파트의 가격은 13억3천5백만원입니다. 그리고 매매건수는 상계동>중계동>공릉동 순입니다.

```{r, eval=FALSE}
nowon %>% 
  summarise(max_price = max(AMOUNT))
#>   max_price
#> 1    133500

nowon %>% 
  group_by(DONG_NM) %>% 
  tally() %>% 
  arrange(desc(n))
#> # A tibble: 5 x 2
#>   DONG_NM       n
#>   <chr>     <int>
#> 1 " 상계동"    27
#> 2 " 중계동"    11
#> 3 " 공릉동"    10
#> 4 " 월계동"     8
#> 5 " 하계동"     3
```
2006년 10월의 성동구의 매매 현황을 수집합니다. chunk의 값을 800으로 지정해서 765건을 수집했습니다. chunk의 기본값은 100으로 100건을 수집합니다.

```{r, eval=FALSE}
LAWD_CD <- legal_divisions %>% 
  filter(CTY_NM %in% "성동구") %>% 
  select(CTY_CD) %>% 
  filter(row_number() == 1) %>% 
  pull()

sungdong <- trade_apt(auth_key, 
                      LAWD_CD = "11200", 
                      DEAL_YMD = "200610",
                      chunk = 800)

NROW(sungdong)
#> [1] 765
```
  
## 네이버 뉴스 검색 예제
"불평등"이라는 키워드로 뉴스현황을 검색합니다.

사용자의 클라이언트 아이디와 보안키를 입력합니다. 사전에 네이버로부터 발급받아야 합니다.

```{r, eval=FALSE}
# Your authorized API keys
client_id <- "XXXXXXXXXXXXXXXXXXXXXXX"
client_secret <- "XXXXXXXXX"
```

총 285,030건의 뉴스가 검색되었고 100건을 수집했습니다.

```{r, eval=FALSE}
inequality <- search_naver(
  "불평등", client_id = client_id, client_secret = client_secret
)
#> * 검색된 총 기사 건수는 285036건입니다.
#> - (100/285036)건 호출을 진행합니다.
```

1000건을 수집해 보겠습니다.

```{r, eval=FALSE}
inequality_1000 <- search_naver(
  "불평등", client_id = client_id, client_secret = client_secret,
  do_done = TRUE, max_record = 1000
)
#> * 검색된 총 기사 건수는 285036건입니다.
#> - (100/1000)건 호출을 진행합니다.
#> - (200/1000)건 호출을 진행합니다.
#> - (300/1000)건 호출을 진행합니다.
#> - (400/1000)건 호출을 진행합니다.
#> - (500/1000)건 호출을 진행합니다.
#> - (600/1000)건 호출을 진행합니다.
#> - (700/1000)건 호출을 진행합니다.
#> - (800/1000)건 호출을 진행합니다.
#> - (900/1000)건 호출을 진행합니다.
#> - (1000/1000)건 호출을 진행합니다.
```

```{r, eval=FALSE}
head(inequality_1000)
#>                                                                               title
#> 1                                          이재명 후보, 문화예술 분야 6대 공약 발표
#> 2                        조영수 이사장 “다른 사람의 관점에서 나를 성찰하게 하는 책”
#> 3                [D:이슈] 장르물에 녹여낸 한국 사회…넷플릭스 오리지널 장점이자 한계
#> 4              &quot;기후위기 대응 64개국 중 59위…우물 안 K-대통령 돼선 안 돼&quot;
#> 5                       [지자체의 SR] 의정부시, 스마트시티 조성 탄력…국비 20억 확보
#> 6 이재명 &quot;미래산업 핵심은 재생에너지&quot; 윤석열 &quot;데이터·AI가 핵심&quot;
#>                                                                     originallink
#> 1 http://www.cine21.com/news/view/?mag_id=99572&utm_source=naver&utm_medium=news
#> 2                                         http://ch.yes24.com/Article/View/46942
#> 3                          https://www.dailian.co.kr/news/view/1079823/?sc=Naver
#> 4                                       https://www.nocutnews.co.kr/news/5700762
#> 5                       http://www.srtimes.kr/news/articleView.html?idxno=107666
#> 6                        https://www.eroun.net/news/articleView.html?idxno=27524
#>                                                                                      link
#> 1 https://news.naver.com/main/read.naver?mode=LSD&mid=sec&sid1=106&oid=140&aid=0000046515
#> 2                                                  http://ch.yes24.com/Article/View/46942
#> 3 https://news.naver.com/main/read.naver?mode=LSD&mid=sec&sid1=103&oid=119&aid=0002572721
#> 4 https://news.naver.com/main/read.naver?mode=LSD&mid=sec&sid1=102&oid=079&aid=0003604477
#> 5                                http://www.srtimes.kr/news/articleView.html?idxno=107666
#> 6                                 https://www.eroun.net/news/articleView.html?idxno=27524
#>                                                                                                                                                                                                                                                                         description
#> 1                                                               방식의 영화 제작 지원을 확대하고, 애니메이션 투자펀드를 만들겠다는 것이다. 이 후보는 대기업의 독과점, 계약 관계의 <b>불평등</b> 등을 시정해 문화예술 분야에 공정한 생태계를 조성할 수 있도록 노력하겠다고 강조했다.
#> 2                                                               그리고 글로벌 각국이 갖는 <b>불평등</b>에 대한 의문을 해소해주는 책이죠. 『수레바퀴 밑에서』 헤르만 헤세 저 수레바퀴 밑에서 헤르만 헤세 저 | 강태정 역 일신서적출판사 주인공 한스의 방황과 고뇌가 고등학생 시절... 
#> 3                                                              나아가 극한 경쟁에 내몰린 현대인과 개인의 힘으로는 극복하기 힘든 <b>불평등</b> 문제 등 작품에 녹아있는 메시지도 ‘오징어 게임’을 한층 새로운 데스 게임 드라마로 보이게 했다. 그러나 국내 시청자들은 ‘오징어 게임’... 
#> 4                                                 그다음에 <b>불평등</b> 여러 가지 쭉 나오는데 이 기후위기는 10위 안에도 못 들어갔습니다. ◇이윤상&gt; 기후위기가... 물론 부동산, 일자리, <b>불평등</b> 모두 중요하지만 기후위기는 모든 인류를 다 끝내는 거 아닙니까 그래서 이런... 
#> 5                                                            사업 대상지 내 중랑천 약 4Km 구간에 다목적 AI 스마트 폴 및 스마트 게이트 등을 구축해 사물인터넷과 스마트 정보 체계를 연동하고 홍수 등 재난 위험 상황에 대한 즉각 대응체계 마련 및 정보 서비스 <b>불평등</b> 환경을... 
#> 6 尹 &quot;핵폐기물 처리기술 고도화될 것&quot; 李 &quot;원전 정략대상 아냐&quot; 심상정 &quot;<b>불평등</b> 해소·녹색전환&quot; 안철수... 沈 &quot;<b>불평등</b> 해소·녹색전환&quot; 安 &quot;과학기술 주권국가&quot; 강조 토론 중에는 각 후보의 일자리·성장 방안에 대한 철학도... 
#>          publish_date
#> 1 2022-02-04 15:17:00
#> 2 2022-02-04 14:56:00
#> 3 2022-02-04 14:49:00
#> 4 2022-02-04 14:44:00
#> 5 2022-02-04 14:42:00
#> 6 2022-02-04 14:14:00
#>                                                       title_text
#> 1                        이재명 후보 문화예술 분야 6대 공약 발표
#> 2       조영수 이사장 다른 사람의 관점에서 나를 성찰하게 하는 책
#> 3 D이슈 장르물에 녹여낸 한국 사회넷플릭스 오리지널 장점이자 한계
#> 4         기후위기 대응 64개국 중 59위우물 안 K대통령 돼선 안 돼
#> 5        지자체의 SR 의정부시 스마트시티 조성 탄력국비 20억 확보
#> 6       이재명 미래산업 핵심은 재생에너지 윤석열 데이터AI가 핵심
#>                                                                                                                                                                                                  description_text
#> 1    방식의 영화 제작 지원을 확대하고, 애니메이션 투자펀드를 만들겠다는 것이다. 이 후보는 대기업의 독과점, 계약 관계의 불평등 등을 시정해 문화예술 분야에 공정한 생태계를 조성할 수 있도록 노력하겠다고 강조했다.
#> 2    그리고 글로벌 각국이 갖는 불평등에 대한 의문을 해소해주는 책이죠. 『수레바퀴 밑에서』 헤르만 헤세 저 수레바퀴 밑에서 헤르만 헤세 저 | 강태정 역 일신서적출판사 주인공 한스의 방황과 고뇌가 고등학생 시절... 
#> 3   나아가 극한 경쟁에 내몰린 현대인과 개인의 힘으로는 극복하기 힘든 불평등 문제 등 작품에 녹아있는 메시지도 ‘오징어 게임’을 한층 새로운 데스 게임 드라마로 보이게 했다. 그러나 국내 시청자들은 ‘오징어 게임’... 
#> 4 그다음에 불평등 여러 가지 쭉 나오는데 이 기후위기는 10위 안에도 못 들어갔습니다. ◇이윤상 기후위기가... 물론 부동산, 일자리, 불평등 모두 중요하지만 기후위기는 모든 인류를 다 끝내는 거 아닙니까 그래서 이런... 
#> 5 사업 대상지 내 중랑천 약 4Km 구간에 다목적 AI 스마트 폴 및 스마트 게이트 등을 구축해 사물인터넷과 스마트 정보 체계를 연동하고 홍수 등 재난 위험 상황에 대한 즉각 대응체계 마련 및 정보 서비스 불평등 환경을... 
#> 6         尹 핵폐기물 처리기술 고도화될 것 李 원전 정략대상 아냐 심상정 불평등 해소·녹색전환 안철수... 沈 불평등 해소·녹색전환 安 과학기술 주권국가 강조 토론 중에는 각 후보의 일자리·성장 방안에 대한 철학도...
```

## 네이버 뉴스 검색 앱

네이버 뉴스를 검색하는 Shiny 앱을 제공합니다. 다음과 같은 기능을 제공합니다.

- 네이버 뉴스 검색 기능
- 수집된 개별 뉴스의 원문 팝업 기능
- 수집된 뉴스의 Description에 대한 명사 워드클라우드 시각화

다음과 같이 실행합니다.

```{r, eval=FALSE}
library(koscrap)

explore_news()
```

